开发环境
=========

Sew control studio是工缝电控专用开发集成环境, 用于方便快捷的开发各类缝纫功能以及人机界面.

.. image::  /.//image//ide.png
   :align: center
   :width: 800px
   :alt: ide

|  

如图所示，最上面是菜单和工具栏，左边是工程管理区，右边是代码编辑或设计器编辑区域，最下面是信息输出区。

工程管理区里面分了几个部分，如图中1，2，3，4所示。

1. 公用模型文件，这个是模型描述了机器的工作过程，即主电机运动过程以及运动时伴随的各种输出动作。

.. image::  /.//image//motion-design.png
   :align: center
   :width: 800px
   :alt: motion-design

|  

此模型产生的结构体变量为人机界面和运动控制器公用，人机界面可对其进行修改，运动控制器则根据模型进行电机运转的控制。

工缝最直接最根本的是产生线迹，主要是通过控制主轴电机运动来产生线迹，在主轴电机运转的过程中，在特定的针数以及角度范围内叠加电磁铁/阀或步进电机等动作，最后完成机器所需要的动作。

SewScript定义了一个工缝模型，将运动分成若干节（Segment），每一节对速度、针数、停止角度、起动信号、是否自动运行、是否自动与下一节进行连接等都可以进行配置，Segment可以由用户代码来实现电机启动前的准备工作（如放压脚，调整送布框等）。

另外还定义了事件（Event），Event可以规定起始角度、结束角度，可以设置为简单端口输出，也可以自己定义任务（如步进电机送布）。Event可以绑定在Segment上。

运动控制器就按照这一张多个Segment，多个Event来逐一实现。模型可以借助辅助软件来建立，并自动生成代码。用户只需填入各Segment或Event的自定义代码。

设置完成后，可自动生成参数表以及公用模型代码。速度、角度等设置均可用参数设置。具体可参见运动控制API中的Segment结构体定义。

.. image::  /.//image//motion-code.png
   :align: center
   :width: 400px
   :alt: motion-code

|  

2. 人机界面代码区域

可由人机界面设计器自动生成代码，用户只要填入每个按钮或其他控件的点击事件处理或其他事件处理即可。

3. 运动控制代码区域

用户只要填入每个阶段的启动前准备以及启动触发条件即可。一般为调整送布或调整压脚等缝纫前准备，或等待某个启动条件。

4. 人机界面设计文件

.. image::  /.//image//gui-design.png
   :align: center
   :width: 800px
   :alt: gui-design

|

人机界面设计器和visual studio一样，可以用拖控件的方式生成界面，界面所见即所得，并支持界面到代码的跳转。IDE提供了窗体、按钮、文本、列表、进度条、二维码等多种Widget。

设计完成后，可自动生成人机界面代码。

.. image::  /.//image//gui-code.png
   :align: center
   :width: 400px
   :alt: gui-code

|

5. 工程的设置

.. image::  /.//image//project-option.png
   :align: center
   :width: 400px
   :alt: project-option

|

一个工程包含了人机界面和运动控制两部分，因此工程设置里有两组选项设置。主要设置项是设置真实MCU存放字节码的地址，以及模拟仿真程序路径。

6. 模拟调试界面

.. image::  /.//image//simulate.png
   :align: center
   :width: 800px
   :alt: simulate

|

代码编译通过后，便可以进行模拟调试。模拟器可模拟人机界面和运动控制的绝大部分行为，如按钮动作，界面跳转，参数通信，电机运转，电磁铁/阀动作、步进电机送布动作等等。

以上将在程序示例中展示。
