行业背景
================================

设备型电控和平台型电控

1. 设备型电控
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
   工缝电控在过去十几年经过了高速发展，已经变得非常成熟，各项功能也非常完善，已经接近于标准件。

   电控一般基于单片机开发，电机驱动和用户功能都集中在一起，用户可通过参数调整对功能或驱动做一些调整。好处是高度集成，成本很低，这是目前电控的主流设计模式。

.. image:: /.//image//software-job.svg
   :align: center
   :width: 500px
   :alt: software modules

|
   上图是一个典型电控的软件各部分的划分，如图所示功能驱动全部都集成在一起。

   这种模式也存在一些问题，因为功能和电机驱动集成在一起，整机厂想要对电控软件功能或者机器配置做出一些修改，哪怕是很小的改动，如果无法在已存在的参数表框架里通过参数调整实现，就必须通过电控原厂工程师通过修改源代码来实现。因此，现阶段电控厂家交付给整机厂的是一种设备，无法修改模拟调试，用手机打比方，是一种“功能机”。这种电控我们可称之为“设备型电控”。

   对于整机厂来说，向原厂提出非标准化需求有时得到响应较慢，有时重要程度较低无法引起重视，又或原厂为了防止发行程序碎片化拖延修改，始终有隔靴搔痒之感；如果抛开电控厂家自行开发电控，也需要相当多的人力物力资源投入。

   对于电控厂家，功能和驱动全部集中在一起，因为相互耦合的关系，软件里面功能和驱动变成很复杂的互相嵌入。为了尽量兼顾全部机型的需求，参数表也变得越来越庞大，对应的软件复杂度也越来越高。经年累月后，代码逐渐变得可理解性差，可维护性差，只有少数长期跟踪维护的技术人员能够准确的理解和修改代码，让整机厂参与软件修改也非常不现实。

   **整机厂需要一种类似PLC具备二次开发功能的电控， 目前的“设备型电控”无法满足这一点。这就是SewScript产生的背景。**
	
   Sew control studio就是为了分离功能和驱动，实现二次开发而设计的集成式开发环境。Sew control studio的核心是SewScript脚本语言，用户可通过编写SewScript程序来实现二次开发。通过二次开发平台产生的电控，我们称之为“平台型电控”。

2. 平台型电控
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
   具备二次开发能力的电控必须解决以下问题：

   a.  功能和驱动的分离。分离就是把重复性且基础性的驱动和功能分开。二次开发技术人员不可能像设备型电控那样从伺服电机控制的三闭环起步，他们关注的点在于机器线迹的实现， 主要是主轴电机的运动控制以及伴随的辅助电磁铁步进电机等动作。因此开发的重点是运动控制以及伴随动作时序。

   b.  功能的实现。实现就是如何向控制器输入设计者的意图，包括逻辑、流程等。如平缝的前加固， 中间段， 后加固， 剪线以及抬压脚这一工作流程对应的运动轨迹的动作时序。

   c.  运动控制和人机界面库的集成。运动控制是工缝电控的核心，方便而快速的实现缝纫所需要的运动轨迹是最基础的需求。对于特殊机种，还需要考虑多轴协同。触摸屏已越来越广泛应用于工缝，图形化人机界面已经成为很多机型的标准配置。

   d.  功能的模拟。模拟就是对输入的梯形图或程序等进行结果的检查， 看是否能达到设计意图， 和设计预期一致。
	
   e.  功能的调试。调试就是对动作过程能暂停或执行分解单步动作，监视相关各物理量变化，以便排查错误。

   长久以来， 二次开发只能使用PLC或者CodeSys之类的软PLC实现， 这些由于其成本、产品形态以及对于运动控制的开发难度， 只能用于一些较为特殊的设备， 而无法适配广泛的机型。

   我们的设计目标是在不改变传统电控硬件设计，不增加电控BOM成本的前提下，将电机驱动和功能设计分开，向整机厂提供一种能进行二次开发的新型电控。

   平台型电控可理解为一种既保持了传统电控的形态成本，又具备了二次开发功能的新型电控。

3. 名词解释
~~~~~~~~~~~~~~

   为了更清晰的描述二次开发平台，下图列出了平台包含的软硬件各个部分，后续涉及到的各部分就按此图来表述。

.. image:: /.//image//top_view.svg
   :align: center
   :width: 300px
   :alt: Platform terms

|  

   - Sew control studio
   - SewScript
   - Compiler
   - Debugger
   - HMI Simulator
   - Motion Simulator
   - HMI
   - Control box
   